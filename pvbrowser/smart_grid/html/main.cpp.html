<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>main.cpp</title>
</head>
<body>
<pre>
This is the main() cpp sourcefile.
It is initially generated by pvdevelop.
Using the #define USE_INETD you can decide if you want a multi threaded pvserver (default) or use xinetd.
Within pvMain() the handling of your masks starts.
You may insert some lines of your own code in there.
</pre>
<hr>

<pre>
<span style="font-style: italic;color: #808080;">//***************************************************************************</span>
<span style="font-style: italic;color: #808080;">//                          main.cpp  -  description</span>
<span style="font-style: italic;color: #808080;">//                             -------------------</span>
<span style="font-style: italic;color: #808080;">//  begin            : Mi Mrz 28 18:50:07 2007</span>
<span style="font-style: italic;color: #808080;">//  generated by     : pvdevelop (C) 2000-2006 by Lehrig Software Engineering</span>
<span style="font-style: italic;color: #808080;">//  email            : lehrig@t-online.de</span>
<span style="font-style: italic;color: #808080;">//***************************************************************************</span>
<span style="color: #008000;">#include "pvapp.h"</span>
<span style="font-style: italic;color: #808080;">// todo: comment me out. you can insert these objects as extern in your masks.</span>
<span style="color: #000000;">rlModbusClient     modbus(modbusdaemon_MAILBOX,modbusdaemon_SHARED_MEMORY,modbusdaemon_SHARED_MEMORY_SIZE);</span>
<span style="font-style: italic;color: #808080;">//rlSiemensTCPClient siemensTCP(siemensdaemon_MAILBOX,siemensdaemon_SHARED_MEMORY,siemensdaemon_SHARED_MEMORY_SIZE);</span>
<span style="font-style: italic;color: #808080;">//rlPPIClient        ppi(ppidaemon_MAILBOX,ppidaemon_SHARED_MEMORY,ppidaemon_SHARED_MEMORY_SIZE);</span>

<span style="color: #800000;">int</span><span style="color: #000000;"> pvMain(PARAM *p)</span>
<span style="color: #000000;">{</span>
<span style="color: #800000;">int</span><span style="color: #000000;"> ret;</span>

<span style="color: #000000;">  pvSetCaption(p,</span><span style="color: #dd0000;">"pvs"</span><span style="color: #000000;">);</span>
<span style="color: #000000;">  pvResize(p,</span><span style="color: #0000ff;">0</span><span style="color: #000000;">,</span><span style="color: #0000ff;">1280</span><span style="color: #000000;">,</span><span style="color: #0000ff;">1024</span><span style="color: #000000;">);</span>
<span style="color: #000000;">  </span><span style="font-style: italic;color: #808080;">//pvScreenHint(p,1024,768); // this may be used to automatically set the zoomfactor</span>
<span style="color: #000000;">  ret = </span><span style="color: #0000ff;">1</span><span style="color: #000000;">;</span>
<span style="color: #000000;">  pvGetInitialMask(p);</span>
<span style="color: #000000;">  </span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;">(strcmp(p-&gt;initial_mask,</span><span style="color: #dd0000;">"mask1"</span><span style="color: #000000;">) == </span><span style="color: #0000ff;">0</span><span style="color: #000000;">) ret = </span><span style="color: #0000ff;">1</span><span style="color: #000000;">;</span>

<span style="color: #000000;">  </span><span style="font-weight: bold;color: #000000;">while</span><span style="color: #000000;">(</span><span style="color: #0000ff;">1</span><span style="color: #000000;">)</span>
<span style="color: #000000;">  {</span>
<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">switch</span><span style="color: #000000;">(ret)</span>
<span style="color: #000000;">    {</span>
<span style="color: #000000;">      </span><span style="font-weight: bold;color: #000000;">case</span><span style="color: #000000;"> </span><span style="color: #0000ff;">1</span><span style="color: #000000;">:</span>
<span style="color: #000000;">        pvStatusMessage(p,-</span><span style="color: #0000ff;">1</span><span style="color: #000000;">,-</span><span style="color: #0000ff;">1</span><span style="color: #000000;">,-</span><span style="color: #0000ff;">1</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"mask1"</span><span style="color: #000000;">);</span>
<span style="color: #000000;">        ret = show_mask1(p);</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">break</span><span style="color: #000000;">;</span>
<span style="color: #000000;">      </span><span style="font-weight: bold;color: #000000;">default</span><span style="color: #000000;">:</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">0</span><span style="color: #000000;">;</span>
<span style="color: #000000;">    }</span>
<span style="color: #000000;">  }</span>
<span style="color: #000000;">}</span>

<span style="color: #008000;">#ifdef USE_INETD</span>
<span style="color: #800000;">int</span><span style="color: #000000;"> main(</span><span style="color: #800000;">int</span><span style="color: #000000;"> ac, </span><span style="color: #800000;">char</span><span style="color: #000000;"> **av)</span>
<span style="color: #000000;">{</span>
<span style="color: #000000;">PARAM p;</span>

<span style="color: #000000;">  pvInit(ac,av,&amp;p);</span>
<span style="color: #000000;">  </span><span style="font-style: italic;color: #808080;">/* here you may interpret ac,av and set p-&gt;user to your data */</span>
<span style="color: #000000;">  pvMain(&amp;p);</span>
<span style="color: #000000;">  </span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">0</span><span style="color: #000000;">;</span>
<span style="color: #000000;">}</span>
<span style="color: #008000;">#else  </span><span style="font-style: italic;color: #808080;">// multi threaded server</span>
<span style="color: #800000;">int</span><span style="color: #000000;"> main(</span><span style="color: #800000;">int</span><span style="color: #000000;"> ac, </span><span style="color: #800000;">char</span><span style="color: #000000;"> **av)</span>
<span style="color: #000000;">{</span>
<span style="color: #000000;">PARAM p;</span>
<span style="color: #800000;">int</span><span style="color: #000000;">   s;</span>

<span style="color: #000000;">  pvInit(ac,av,&amp;p);</span>
<span style="color: #000000;">  </span><span style="font-style: italic;color: #808080;">/* here you may interpret ac,av and set p-&gt;user to your data */</span>
<span style="color: #000000;">  </span><span style="font-weight: bold;color: #000000;">while</span><span style="color: #000000;">(</span><span style="color: #0000ff;">1</span><span style="color: #000000;">)</span>
<span style="color: #000000;">  {</span>
<span style="color: #000000;">    s = pvAccept(&amp;p);</span>
<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;">(s != -</span><span style="color: #0000ff;">1</span><span style="color: #000000;">) pvCreateThread(&amp;p,s);</span>
<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">break</span><span style="color: #000000;">;</span>
<span style="color: #000000;">  }</span>
<span style="color: #000000;">  </span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">0</span><span style="color: #000000;">;</span>
<span style="color: #000000;">}</span>
<span style="color: #008000;">#endif</span>
</pre></body>
</html>
